[workspace]
name = "hygrep"
version = "0.1.0"
description = "Hybrid grep: fast scanning + neural reranking"
authors = ["nijaru"]
channels = ["conda-forge", "https://conda.modular.com/max/", "pytorch"]
platforms = ["osx-arm64", "linux-64"]

[dependencies]
max = "25.7.*"
python = ">=3.11,<3.14"
huggingface_hub = ">=1.1.6,<2"
numpy = ">=2.3.5,<3"
tokenizers = ">=0.22.1,<0.23"
onnxruntime = ">=1.16.0,<2"

[pypi-dependencies]
tree-sitter = ">=0.24.0"
tree-sitter-python = ">=0.23.0"
tree-sitter-javascript = ">=0.23.0"
tree-sitter-typescript = ">=0.23.0"
tree-sitter-rust = ">=0.23.0"
tree-sitter-go = ">=0.23.0"

[tasks]
# Build Mojo scanner as Python extension
build-ext = "mojo build src/scanner/_scanner.mojo --emit shared-lib -o src/hygrep/_scanner.so"
# Legacy: Build standalone Mojo CLI
build = "mojo build cli.mojo -o hygrep"
# Run Python CLI
hygrep = { cmd = "python -m hygrep.cli", env = { PYTHONPATH = "src" } }
# Run tests
test = "mojo -I . tests/test_regex_smoke.mojo && mojo -I . tests/test_walker.mojo"
# Build wheel (after build-ext)
build-wheel = "python -m build --wheel"
